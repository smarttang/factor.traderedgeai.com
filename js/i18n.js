/**
 * 中英双语 i18n：通过 data-i18n="key" 绑定文案，getLang/setLang/applyLang 切换语言并持久化到 localStorage
 */
(function () {
  var LANG = {
    index: {
      zh: {
        title: 'TraderEdgeAIFactor | 专业的量化组合因子引擎',
        nav_how: '极速上手',
        nav_features: '核心能力',
        nav_factors: '算法因子',
        nav_api: 'API 文档',
        nav_pricing: '定价',
        nav_faq: '常见问题',
        nav_cta: '购买专业版',
        nav_price: '<s>$38/月</s> $30/月',
        hero_tagline: '因子难写、接到策略里更难？',
        hero_desc: '用一个 DLL 接入，在 MT4/MT5 轻松驾驭多因子量化交易引擎，一次搞定。',
        hero_pain_1: '不会因子算法设计？',
        hero_pain_2: '因子的使用太复杂不会用？',
        hero_pain_3: '融合到策略不知道如何起步？',
        hero_pain_solve: '无需思考，接入 TraderEdgeAIFactor 一次搞定！',
        hero_btn_download: '马上下载',
        hero_btn_how: '极速上手',
        hero_security: '交易策略存储在您的本地或您自己的服务器上，我们不会获取您的交易策略任何信息，保障绝对的策略安全性。',
        hero_typed: 'TraderEdgeAIFactor量化引擎',
        how_title: '快速接入',
        how_desc: '下载解压 → 放到 MT4/MQ5 对应目录 → EA 里直接调用，终端即可看到分析结果。无需额外服务端。',
        how_step1_title: '下载解压',
        how_step1_p: '下载压缩包，解压得到 DLL 与 .mqh 头文件、示例 EA，一步到位。',
        how_step2_title: '放入目录',
        how_step2_p: 'DLL 放到 MQL4/Libraries（或 MQL5 对应目录），头文件放到 Include，按平台选对路径即可。',
        how_step3_title: 'EA 调用',
        how_step3_p: '在 EA 里 #include 并 Init 因子，调用 Update() 后即可在终端输出方向、置信度与止损止盈。',
        feat_title: '核心能力',
        feat_desc: '开箱即用、无缝升级、灵活组合，一步到位。',
        feat1_title: '开箱即用，多模式适配',
        feat1_p: '加载 DLL 与 MQ4/MQ5 的 .mqh 即可使用算法因子库。经典模式零配置、直接调用；资深专家模式可调因子参数、优化信号质量。完整 API 文档支持简单接入与深度对接。',
        feat2_title: '无缝升级，0成本0改动',
        feat2_p: '因子库每次升级，您只需替换 DLL，无需改 EA、无需改策略。业务零影响、对接零成本，持续获得新因子与算法优化。',
        feat3_title: '完善信号，多元组合',
        feat3_p: '输出置信度、交易方向、准确度评分、推荐止损止盈等完整信号，支持 Tick 级与长周期。单因子直用、双因子主备权重、多因子投票决策，按需选择。',
        products_title: '量化引擎和算法因子库',
        products_desc: '引入 DLL 后，你既获得统一的 API 对接能力，也可在算法因子市场中按策略习惯选用一个或多个因子。',
        product_tab_dll: '量化引擎',
        product_tab_factors: '算法因子库',
        product_dll_title: '1. 量化引擎',
        product_dll_desc: 'TraderEdgeAIFactor 以单个 DLL 提供统一 API，供 MQ4/MQ5 直接调用，通过 CTEAFactor 封装，按名称选用单因子或配置多因子组合。',
        product_dll_api: '统一 API 调用，简单直接，和原生技术指标一样，快速敏捷接入，不需要太复杂的知识积累。',
        product_dll_out: '统一标准输出：基于 DLL API，可以快速获取到封装好的返回，只需要会用即可，不需要深入研究，专注您擅长的策略即可。',
        product_dll_multi: '多元组合：基于多因子的方式，可以自由组合进行权重调配，让因子动能随着您的设计变得更符合您的预期。',
        product_dll_link: '查看 API 文档',
        product_factors_title: '2. 算法因子',
        product_factors_desc: '算法因子库，按交易场景筛选，快速找到适合你策略的因子。',
        product_factors_link: '去挑选算法因子',
        factor_entropy_sub: '熵场与对冲矩阵',
        factor_trend_sub: '趋势与惩罚',
        factor_tag_mid: '中长线交易',
        factor_tag_trend: '趋势',
        factor_tag_hedge: '货币对冲',
        factor_tag_grid: '网格交易',
        factor_tag_martin: '马丁交易',
        factor_tag_high: '高频交易',
        factor_entropy_desc: '基于熵场与分形维的市场状态判断，输出方向、置信度、regime 及建议止损/止盈。',
        factor_trend_desc: '多技术指标与惩罚引擎结合，输出方向、强度、置信度及 0–100 质量分。',
        pricing_title: '价格表',
        pricing_desc: '可以立刻下载进行集成测试，先用起来。',
        price_free: '免费版',
        price_pro: '专业版',
        price_free_1: '不限制终端数、账号数',
        price_free_2: '完善的API文档支持',
        price_free_3: '30天免费试用',
        price_free_4: '基础的社区支持',
        price_free_5: '所有免费算法因子畅享',
        price_pro_1: '专业的人工售后与支持',
        price_pro_2: '人工协助 API 集成，专业参数配置建议',
        price_pro_3: '所有非定制算法因子均可使用',
        price_pro_4: '年付赠送 2 个月',
        price_pro_5: '基于因子定制开发EA任务，另计费',
        price_btn_free: '免费立刻下载',
        price_btn_pro: '联系购买',
        faq_title: '常见问题',
        faq_intro: '没找到想要的答案？您还可以通过以下方式联系我们，或查看产品使用帮助文档。',
        faq_contact: '联系我们',
        faq_doc: '帮助文档',
        faq_q1: '免费版可以使用哪些因子？',
        faq_a1: '免费版开放部分因子库，提供 30 天试用期。需自行阅读文档完成 API 集成，需求与问题可通过 GitHub ISSUE 提交。',
        faq_q2: '专业版与免费版的主要区别？',
        faq_a2: '专业版提供完整因子库、无期限授权、专属人工对接与 API 集成支持、BUG 当日修复。年付可享赠送 2 个月。',
        faq_q3: 'DLL 是否支持 64 位 MT4？',
        faq_a3: '当前发布版本为 Windows 32 位，适配 MetaTrader 4。MT5 或 64 位环境需单独构建或联系专业版获取适配版本。',
        faq_q4: '如何参与多因子汇总？',
        faq_a4: '使用 CTEAFactorSelector::Init(factorNames, mainFactorName, ...)。单因子传 "EntropyHedge"；双因子传 "EntropyHedge,TrendPenalty" 并指定主因子名；3–8 个因子按名称列表传入即可参与组合。',
        faq_q5: '因子和因子组合有什么区别？',
        faq_a5: '组合因子（如 HedgeCore）内部由多个原子因子组成，但对 API 而言与原子因子一样，都有统一 ID 和标准输出。可以单独用，也可以和任何原子因子、其他组合因子一起参与多因子组合，例如 <code>Init("HedgeCore,VolatilityAdjustedMomentum")</code>。',
        nav_toggle_aria: '菜单',
        code_hero_c1: '// 引入因子库，创建因子实例',
        code_hero_c2: '// 初始化：熵场因子，200 根 K 线',
        code_hero_c3: '// 每 Tick 更新，取方向与动作',
        code_hero_c4: '// -1/0/+1',
        code_hero_c5: '// FLAT/LONG/SHORT',
        code_single_c1: '// Init(name, bars)',
        code_single_c2: '// 每 Tick 调用',
        code_single_c3: '// Signal(sig) → direction, action, confidence',
        code_product_c: '// sig.direction, sig.action, sig.confidence',
        code_tab_single: '单因子',
        code_tab_multi: '多因子',
        code_multi_c1: '// 主 70% 子 30%',
        code_multi_c2: '// 加权后的 direction/action',
        code_multi_c3: '// sig.direction, sig.action, sig.confidence',
        footer_download: '下载',
        footer_how: '极速上手',
        footer_api: 'API 文档',
        footer_pricing: '定价',
        footer_faq: '常见问题',
        footer_copy: '© TraderEdgeAI.com 使用前请阅读授权与免责声明。'
      },
      en: {
        title: 'TraderEdgeAIFactor | Algo Factor Engine',
        nav_toggle_aria: 'Menu',
        code_hero_c1: '// Include factor library, create instance',
        code_hero_c2: '// Init: entropy factor, 200 bars',
        code_hero_c3: '// Update on each tick, get direction and action',
        code_hero_c4: '// -1/0/+1',
        code_hero_c5: '// FLAT/LONG/SHORT',
        code_single_c1: '// Init(name, bars)',
        code_single_c2: '// Call per tick',
        code_single_c3: '// Signal(sig) → direction, action, confidence',
        code_product_c: '// sig.direction, sig.action, sig.confidence',
        code_tab_single: 'Single factor',
        code_tab_multi: 'Multi-factor',
        code_multi_c1: '// 70% main + 30% sub',
        code_multi_c2: '// Weighted direction/action',
        code_multi_c3: '// sig.direction, sig.action, sig.confidence',
        nav_how: 'Quick Start',
        nav_features: 'Features',
        nav_factors: 'Factors',
        nav_api: 'API Docs',
        nav_pricing: 'Pricing',
        nav_faq: 'FAQ',
        nav_cta: 'Get Pro',
        nav_price: '<s>$38/mo</s> $30/mo',
        hero_tagline: 'Factors hard to write, harder to plug into strategy?',
        hero_desc: 'One DLL to plug in—master the multi-factor algo engine on MT4/MT5, done.',
        hero_pain_1: 'No idea how to design factors?',
        hero_pain_2: 'Factor APIs too complex?',
        hero_pain_3: 'Not sure how to integrate into your EA?',
        hero_pain_solve: 'Just plug in TraderEdgeAIFactor and you\'re done.',
        hero_btn_download: 'Download',
        hero_btn_how: 'Quick Start',
        hero_security: 'Your strategy runs locally or on your server. We never access your strategy data. Your strategy stays private.',
        hero_typed: 'TraderEdgeAIFactor Engine',
        how_title: 'Quick Setup',
        how_desc: 'Download → Extract to MT4/MQ5 directories → Call from your EA. No extra server needed.',
        how_step1_title: 'Download',
        how_step1_p: 'Get the zip with DLL, .mqh headers, and sample EA—all in one.',
        how_step2_title: 'Install',
        how_step2_p: 'Put the DLL in MQL4/Libraries (or MQL5 equivalent), headers in Include. Pick the right path for your platform.',
        how_step3_title: 'Call from EA',
        how_step3_p: '#include and Init the factor, call Update(); then read direction, confidence, and SL/TP from the terminal.',
        feat_title: 'Features',
        feat_desc: 'Ready to use, seamless upgrades, flexible combinations.',
        feat1_title: 'Ready to use, multiple modes',
        feat1_p: 'Load the DLL and .mqh to use the factor library. Classic mode: zero config. Expert mode: tune parameters and optimize signal quality. Full API docs for simple or deep integration.',
        feat2_title: 'Seamless upgrades, zero cost',
        feat2_p: 'On each factor library update, just replace the DLL. No EA or strategy changes. No extra cost, continuous new factors and improvements.',
        feat3_title: 'Rich signals, multi-factor',
        feat3_p: 'Outputs confidence, direction, accuracy score, suggested SL/TP. Tick-level and longer timeframes. Single factor, dual with weights, or 3–8 factor voting—your choice.',
        products_title: 'Engine & Factor Library',
        products_desc: 'One DLL gives you a unified API and access to the factor market—pick one or more factors by strategy style.',
        product_tab_dll: 'Engine',
        product_tab_factors: 'Factor Library',
        product_dll_title: '1. Engine',
        product_dll_desc: 'TraderEdgeAIFactor provides a single DLL with a unified API for MQ4/MQ5. Use CTEAFactor to pick a single factor or configure multi-factor combos by name.',
        product_dll_api: 'Unified API calls: simple and direct, like native indicators. Quick integration with minimal learning curve.',
        product_dll_out: 'Unified standard output: Get ready-made returns from the DLL API. Use it without deep study—focus on your strategy.',
        product_dll_multi: 'Flexible combinations: Combine factors with customizable weights. Shape factor dynamics to match your design.',
        product_dll_link: 'API Docs',
        product_factors_title: '2. Factor Library',
        product_factors_desc: 'Algorithm factor library. Filter by scenario to find factors that fit your strategy.',
        product_factors_link: 'Browse factors →',
        factor_entropy_sub: 'Entropy & hedge matrix',
        factor_trend_sub: 'Trend & penalty',
        factor_tag_mid: 'Swing',
        factor_tag_trend: 'Trend',
        factor_tag_hedge: 'Hedge',
        factor_tag_grid: 'Grid',
        factor_tag_martin: 'Martingale',
        factor_tag_high: 'HFT',
        factor_entropy_desc: 'Market regime from entropy and fractal dimension; outputs direction, confidence, regime, and suggested SL/TP.',
        factor_trend_desc: 'Multi-indicator + penalty engine; outputs direction, strength, confidence, and 0–100 quality score.',
        factor_hedge_regime_sub: 'Trend · Osc · Brake',
        factor_hedge_regime_desc: 'R² + BB breakout + ATR; outputs regime, brake, direction, confidence. Aligned with EA logic.',
        factor_trend_strength_sub: 'Multi-period R² · Brake',
        factor_trend_strength_desc: 'Multi-period R² + volatility threshold + adaptive brake 0~1. For fine risk control.',
        factor_reduction_sub: 'Reduction advice',
        factor_reduction_desc: 'Single/cross-side reduction; auto head/tail profit segments, regime-adaptive. Profit first, then loss.',
        factor_rsquared_sub: 'Trend strength R²',
        factor_rsquared_desc: 'Pearson / Theil-Sen / EWM R², DLL-computed, robust, outlier-resistant.',
        factor_tag_vol: 'Volatility',
        factor_tag_stable: 'Stable',
        pricing_title: 'Pricing',
        pricing_desc: 'Download and integrate for testing right away.',
        price_free: 'Free',
        price_pro: 'Pro',
        price_free_1: 'Unlimited terminals and accounts',
        price_free_2: 'Full API documentation',
        price_free_3: '30-day free trial',
        price_free_4: 'Community support',
        price_free_5: 'All free factors included',
        price_pro_1: 'Dedicated support',
        price_pro_2: 'API integration help and parameter tuning',
        price_pro_3: 'All non-custom factors',
        price_pro_4: '2 months free on annual plan',
        price_pro_5: 'Custom EA development billed separately',
        price_btn_free: 'Download Free',
        price_btn_pro: 'Contact to buy',
        faq_title: 'FAQ',
        faq_intro: 'Can\'t find your answer? Contact us or check the docs.',
        faq_contact: 'Contact us',
        faq_doc: 'Docs',
        faq_q1: 'What factors are in the free tier?',
        faq_a1: 'Free tier includes a subset of factors and a 30-day trial. Integrate via the API using the docs; ask questions via GitHub ISSUE.',
        faq_q2: 'What\'s the difference between Pro and Free?',
        faq_a2: 'Pro: full factor set, no time limit, dedicated support, API integration help, same-day bug fixes. Annual plan gets 2 months free.',
        faq_q3: 'Does the DLL support 64-bit MT4?',
        faq_a3: 'Current build is Windows 32-bit for MetaTrader 4. MT5 or 64-bit builds are available on request (e.g. via Pro).',
        faq_q4: 'How do I use multiple factors together?',
        faq_a4: 'Use CTEAFactorSelector::Init(factorNames, mainFactorName, ...). One factor: "EntropyHedge"; two: "EntropyHedge,TrendPenalty" with main name; 3–8 factors: pass the name list.',
        faq_q5: 'What is the difference between factors and factor combinations?',
        faq_a5: 'Composite factors (e.g. HedgeCore) internally combine multiple atomic factors, but for the API they behave like atomic factors: unified ID and standard output. Use alone or with any atomic/composite factor in multi-factor combos, e.g. <code>Init("HedgeCore,VolatilityAdjustedMomentum")</code>.',
        footer_download: 'Download',
        footer_how: 'Quick Start',
        footer_api: 'API Docs',
        footer_pricing: 'Pricing',
        footer_faq: 'FAQ',
        footer_copy: '© TraderEdgeAI.com Please read the license and disclaimer.'
      }
    },
    factors: {
      zh: {
        title: '算法因子市场 | TraderEdgeAIFactor',
        nav_how: '极速上手', nav_features: '核心能力', nav_factors: '算法因子', nav_api: 'API 文档', nav_pricing: '定价', nav_faq: '常见问题', nav_cta: '购买专业版', nav_price: '<s>$38/月</s> $30/月',
        page_title: '算法因子市场',
        page_desc: '按交易场景筛选，快速找到适合你策略的算法因子。',
        sidebar_title: '按场景筛选',
        filter_group_style: '交易风格',
        filter_group_signal: '信号类型',
        tag_all: '全部', tag_composite: '组合', tag_trend: '趋势', tag_hedge: '对冲', tag_martin: '马丁', tag_grid: '网格', tag_vol: '波动', tag_short: '短线', tag_swing: '波段', tag_reduction: '减仓',
        tag_mid: '中长线', tag_high: '高频', tag_momentum: '动量', tag_mtf: '多周期', tag_gap: '跳空', tag_spread: '价差', tag_range: '区间', tag_session: '会话', tag_r2: 'R²',
        back: '← 返回产品介绍',
        api_quick_start: 'API 快速接入',
        factor_entropy_sub: '熵场与对冲矩阵', factor_trend_sub: '趋势与惩罚',
        factor_hedge_regime_sub: '趋势·震荡·刹车', factor_trend_strength_sub: '多周期 R²·刹车强度',
        factor_reduction_sub: '削单建议', factor_rsquared_sub: '趋势强度 R²',
        factor_entropy_desc: '基于熵场与分形维的市场状态判断，结合多周期共振与对冲矩阵，输出方向、置信度、regime 及建议止损/止盈。适合中长线与多品种对冲策略。',
        factor_trend_desc: '多技术指标与惩罚引擎结合，输出方向、强度、置信度、regime 及 0–100 质量分。适合网格、马丁及需要 Tick 级信号的策略。',
        factor_hedge_regime_desc: 'R² + 布林带突破 + ATR，输出 regime、刹车标志、方向与置信度，与对冲 EA 逻辑对齐。扩展 API：TEA_FactorGetBrake、TEA_FactorGetATR。',
        factor_trend_strength_desc: '多周期 R² + 波动率阈值 + 自适应带宽刹车强度 0~1，适合精细风控与趋势强度判断。扩展 API：TEA_FactorGetBrakeStrength。',
        factor_reduction_desc: '单侧/跨侧削单推荐，头尾盈利段自动识别，regime 自适应。传入多空两侧持仓快照与参数，返回本 tick 是否削单、削哪一侧、先平盈利再平亏损。无状态、可重复调用。',
        factor_rsquared_desc: 'Pearson（数值稳定）/ Theil-Sen 稳健 / 指数加权 R²，DLL 内计算、抗异常值。传入收盘价数组与周期，返回 0~1 趋势强度。适合替代 MQL4 手写 R²。',
        factor_tag_mid: '中长线', factor_tag_trend: '趋势', factor_tag_hedge: '货币对冲', factor_tag_grid: '网格', factor_tag_martin: '马丁', factor_tag_high: '高频', factor_tag_reduction: '削单', factor_tag_r2: 'R²',
        factor_unified_api: '统一接口：TraderEdgAIFactor.mqh · TEA_FactorCreate(0)',
        factor_unified_api_1: '统一接口：TraderEdgAIFactor.mqh · TEA_FactorCreate(1)',
        factor_unified_api_2: '统一接口：TraderEdgAIFactor.mqh · TEA_FactorCreate(2)',
        factor_unified_api_3: '统一接口：TraderEdgAIFactor.mqh · TEA_FactorCreate(3)',
        factor_standalone_reduction: '独立 API：TEA_ReductionRecommend · TraderEdgAIFactor.mqh',
        factor_standalone_rsquared: '独立 API：TEA_RSquared / TEA_RSquaredEx · TraderEdgAIFactor.mqh',
        factor_id_standalone: '独立 API',
        factors_group_all: '所有算法因子和组合',
        factors_group_special: '特殊算法因子',
        factor_volspike_sub: '波动率尖峰',
        factor_jump_sub: '跳空/闪崩检测',
        factor_mtfalign_sub: '多周期对齐',
        factor_hurst_sub: 'Hurst 指数 regime',
        factor_hedgecore_sub: 'XAUUSD 对冲一体化',
        factor_stepscale_sub: '步长缩放',
        factor_momentum_exhaust_sub: '动量衰竭',
        factor_volregime_sub: '波动率状态',
        factor_gapfill_sub: '跳空回补得分',
        factor_asymbrake_sub: '多空独立刹车',
        factor_vam_sub: '波动率调整动量',
        factor_ati_sub: '自适应趋势强度',
        factor_mtr_sub: '多周期共振',
        factor_pairspread_sub: '价差 Z 分数',
        factor_coint_sub: '协整价差 (Kalman)',
        factor_rangepos_sub: '区间位置',
        factor_session_sub: '会话 regime',
        factor_hedgeimb_sub: '对冲失衡',
        factor_volspike_desc: '检测波动率尖峰，输出 spike_ratio。扩展：TEA_FactorGetVolatilitySpikeRatio。',
        factor_jump_desc: '检测跳空与闪崩，输出 jump_score、is_jump。扩展：TEA_FactorGetJumpScore、TEA_FactorGetIsJump。',
        factor_mtfalign_desc: '多时间框架动量对齐，判断多周期是否共振。',
        factor_hurst_desc: 'Hurst 指数判断趋势/均值回归 regime。扩展：TEA_FactorGetHurst。',
        factor_hedgecore_desc: '内部整合 HedgeRegime + VolatilitySpike + JumpDetector，输出 regime、刹车、ATR、StepScale、VolRegime。',
        factor_stepscale_desc: '根据波动率输出步长缩放系数 0.5~1.5。扩展：TEA_FactorGetStepScale。',
        factor_momentum_exhaust_desc: '动量衰竭检测。扩展：TEA_FactorGetExhaustionScore。',
        factor_volregime_desc: '波动率分级 regime + 缩放系数。扩展：TEA_FactorGetVolRegime、TEA_FactorGetVolScale。',
        factor_gapfill_desc: '跳空回补概率得分。扩展：TEA_FactorGetGapFillScore、TEA_FactorGetHasGap。',
        factor_asymbrake_desc: '多空侧独立刹车标志。扩展：TEA_FactorGetBrakeBuy、TEA_FactorGetBrakeSell。',
        factor_vam_desc: 'VAM = 价格变化/即时波动率，动态阈值。扩展：TEA_FactorGetVAM、TEA_FactorGetVAMThreshold。',
        factor_ati_desc: 'ER + AMA + 趋势强度。扩展：TEA_FactorGetER、TEA_FactorGetTrendIntensity。',
        factor_mtr_desc: '多档 EMA 动量对齐，输出 alignment、resonance。扩展：TEA_FactorGetAlignment、TEA_FactorGetResonance。',
        factor_pairspread_desc: '双品种价差 Z 分数，固定对冲比率。TEA_PairSpreadZ(closes_a, closes_b, count, hedge_ratio)',
        factor_coint_desc: '金银等协整价差，Kalman 滤波动态对冲比，输出 beta、spread、zscore、signal。TEA_CointegrationSpread',
        factor_rangepos_desc: '当前价格在近期高低区间的相对位置 0~1。TEA_RangePosition',
        factor_session_desc: '按小时/分钟返回会话 regime 与波动率缩放。TEA_SessionRegime',
        factor_hedgeimb_desc: '多空盈亏失衡时输出刹车建议。TEA_HedgeImbalance',
        sidebar_aria: '按策略标签筛选', nav_toggle_aria: '菜单',
        footer_download: '下载', footer_how: '极速上手', footer_api: 'API 文档', footer_pricing: '定价', footer_faq: '常见问题', footer_copy: '© TraderEdgeAI.com 使用前请阅读授权与免责声明。'
      },
      en: {
        title: 'Factor Market | TraderEdgeAIFactor',
        nav_how: 'Quick Start', nav_features: 'Features', nav_factors: 'Factors', nav_api: 'API Docs', nav_pricing: 'Pricing', nav_faq: 'FAQ', nav_cta: 'Get Pro', nav_price: '<s>$38/mo</s> $30/mo',
        page_title: 'Factor Market',
        page_desc: 'Filter by scenario to quickly find algorithm factors that fit your strategy.',
        sidebar_title: 'Filter by scenario',
        filter_group_style: 'Trading style',
        filter_group_signal: 'Signal type',
        sidebar_aria: 'Filter by strategy tag', nav_toggle_aria: 'Menu',
        tag_all: 'All', tag_composite: 'Composite', tag_trend: 'Trend', tag_hedge: 'Hedge', tag_martin: 'Martingale', tag_grid: 'Grid', tag_vol: 'Volatility', tag_short: 'Short-term', tag_swing: 'Swing', tag_reduction: 'Reduce',
        tag_mid: 'Swing', tag_high: 'HFT', tag_momentum: 'Momentum', tag_mtf: 'Multi-TF', tag_gap: 'Gap', tag_spread: 'Spread', tag_range: 'Range', tag_session: 'Session', tag_r2: 'R²',
        back: '← Back to products',
        api_quick_start: 'Quick start',
        factor_entropy_sub: 'Entropy & hedge matrix', factor_trend_sub: 'Trend & penalty',
        factor_hedge_regime_sub: 'Trend · Osc · Brake', factor_trend_strength_sub: 'Multi-period R² · Brake',
        factor_reduction_sub: 'Reduction advice', factor_rsquared_sub: 'Trend strength R²',
        factor_entropy_desc: 'Market regime from entropy and fractal dimension; multi-timeframe and hedge matrix. Outputs direction, confidence, regime, and suggested SL/TP. Suited for swing and multi-currency hedge.',
        factor_trend_desc: 'Multi-indicator + penalty engine; outputs direction, strength, confidence, regime, and 0–100 quality score. Suited for grid, martingale, and tick-level strategies.',
        factor_hedge_regime_desc: 'R² + Bollinger breakout + ATR; outputs regime, brake flag, direction, confidence. Ext: TEA_FactorGetBrake, TEA_FactorGetATR.',
        factor_trend_strength_desc: 'Multi-period R² + volatility threshold + adaptive brake 0~1. Ext: TEA_FactorGetBrakeStrength.',
        factor_reduction_desc: 'Single/cross-side reduction; auto head/tail profit segments, regime-adaptive. Returns whether to reduce, which side; profit-first then loss. Stateless.',
        factor_rsquared_desc: 'Pearson / Theil-Sen / EWM R², DLL-computed, robust. Returns 0~1 trend strength. Replaces MQL4 R².',
        factor_tag_mid: 'Swing', factor_tag_trend: 'Trend', factor_tag_hedge: 'Hedge', factor_tag_grid: 'Grid', factor_tag_martin: 'Martingale', factor_tag_high: 'HFT', factor_tag_reduction: 'Reduction', factor_tag_r2: 'R²',
        factor_unified_api: 'Unified: TraderEdgAIFactor.mqh · TEA_FactorCreate(0)',
        factor_unified_api_1: 'Unified: TraderEdgAIFactor.mqh · TEA_FactorCreate(1)',
        factor_unified_api_2: 'Unified: TraderEdgAIFactor.mqh · TEA_FactorCreate(2)',
        factor_unified_api_3: 'Unified: TraderEdgAIFactor.mqh · TEA_FactorCreate(3)',
        factor_standalone_reduction: 'Standalone: TEA_ReductionRecommend · TraderEdgAIFactor.mqh',
        factor_standalone_rsquared: 'Standalone: TEA_RSquared / TEA_RSquaredEx · TraderEdgAIFactor.mqh',
        factor_id_standalone: 'Standalone API',
        factors_group_all: 'All algorithm factors & combinations',
        factors_group_special: 'Special algorithm factors',
        factor_volspike_sub: 'Volatility spike',
        factor_jump_sub: 'Jump / flash crash detect',
        factor_mtfalign_sub: 'Multi-timeframe align',
        factor_hurst_sub: 'Hurst regime',
        factor_hedgecore_sub: 'XAUUSD hedge integration',
        factor_stepscale_sub: 'Step scale',
        factor_momentum_exhaust_sub: 'Momentum exhaustion',
        factor_volregime_sub: 'Volatility regime',
        factor_gapfill_sub: 'Gap fill score',
        factor_asymbrake_sub: 'Asymmetric brake',
        factor_vam_sub: 'Volatility-adjusted momentum',
        factor_ati_sub: 'Adaptive trend intensity',
        factor_mtr_sub: 'Multi-timeframe resonance',
        factor_pairspread_sub: 'Pair spread Z-score',
        factor_coint_sub: 'Cointegration spread (Kalman)',
        factor_rangepos_sub: 'Range position',
        factor_session_sub: 'Session regime',
        factor_hedgeimb_sub: 'Hedge imbalance',
        factor_volspike_desc: 'Detects volatility spikes; outputs spike_ratio. Ext: TEA_FactorGetVolatilitySpikeRatio.',
        factor_jump_desc: 'Detects jumps and flash crashes; outputs jump_score, is_jump. Ext: TEA_FactorGetJumpScore, TEA_FactorGetIsJump.',
        factor_mtfalign_desc: 'Multi-timeframe momentum alignment; checks multi-period resonance.',
        factor_hurst_desc: 'Hurst exponent for trend/mean-reversion regime. Ext: TEA_FactorGetHurst.',
        factor_hedgecore_desc: 'Integrates HedgeRegime + VolatilitySpike + JumpDetector; outputs regime, brake, ATR, StepScale, VolRegime.',
        factor_stepscale_desc: 'Outputs step-scale factor 0.5~1.5 by volatility. Ext: TEA_FactorGetStepScale.',
        factor_momentum_exhaust_desc: 'Momentum exhaustion detection. Ext: TEA_FactorGetExhaustionScore.',
        factor_volregime_desc: 'Volatility regime + scale factor. Ext: TEA_FactorGetVolRegime, TEA_FactorGetVolScale.',
        factor_gapfill_desc: 'Gap-fill probability score. Ext: TEA_FactorGetGapFillScore, TEA_FactorGetHasGap.',
        factor_asymbrake_desc: 'Independent brake flags for long/short. Ext: TEA_FactorGetBrakeBuy, TEA_FactorGetBrakeSell.',
        factor_vam_desc: 'VAM = price change / instant volatility; dynamic threshold. Ext: TEA_FactorGetVAM, TEA_FactorGetVAMThreshold.',
        factor_ati_desc: 'ER + AMA + trend intensity. Ext: TEA_FactorGetER, TEA_FactorGetTrendIntensity.',
        factor_mtr_desc: 'Multi-EMA momentum alignment; outputs alignment, resonance. Ext: TEA_FactorGetAlignment, TEA_FactorGetResonance.',
        factor_pairspread_desc: 'Pair spread Z-score; fixed hedge ratio. TEA_PairSpreadZ(closes_a, closes_b, count, hedge_ratio)',
        factor_coint_desc: 'Cointegration spread (e.g. gold/silver); Kalman dynamic hedge; outputs beta, spread, zscore, signal. TEA_CointegrationSpread',
        factor_rangepos_desc: 'Current price position 0~1 within recent high/low range. TEA_RangePosition',
        factor_session_desc: 'Returns session regime and volatility scaling by hour/minute. TEA_SessionRegime',
        factor_hedgeimb_desc: 'Outputs brake recommendation when long/short P/L is imbalanced. TEA_HedgeImbalance',
        footer_download: 'Download', footer_how: 'Quick Start', footer_api: 'API Docs', footer_pricing: 'Pricing', footer_faq: 'FAQ', footer_copy: '© TraderEdgeAI.com Please read the license and disclaimer.'
      }
    },
    api: {
      zh: {
        title: 'API 文档 | TraderEdgeAIFactor',
        title_advanced: 'API 文档 · 进阶版 | TraderEdgeAIFactor',
        nav_how: '极速上手', nav_features: '核心能力', nav_factors: '算法因子', nav_api: 'API 文档', nav_pricing: '定价', nav_faq: '常见问题', nav_cta: '购买专业版', nav_price: '<s>$38/月</s> $30/月',
        nav_toggle_aria: '菜单',
        back_to_simple: '← 返回简单对接',
        intro_title: '进阶版 API 文档说明',
        intro_p1: '本页面向高端技术专家开放。若你需要在 EA 中深度对接 TraderEdgAIFactor.dll，需要每个 API 的完整入参、出参及参数说明，以及可直接复用的 MQ4/MQ5 代码片段，请以本页为准。',
        intro_value: '进阶版文档的价值与作用：',
        intro_li1: '减少对接歧义：每个 API 均给出入参、出参、参数含义与取值范围，避免因理解偏差导致调用错误。',
        intro_li2: '提供详细代码片段：MQ4 与 MQ5 双平台示例、注释与常见坑（如数组顺序、调用顺序、返回值检查），便于直接集成、减少反复试错与客服咨询。',
        intro_li3: '仅展示对接用 API：不涉及内部实现与框架，只列出你实际会调用的接口、参数与用法。',
        intro_link: '简单对接（极简代码与场景说明）请见 <a href="api.html">API 文档（简单版）</a>。',
        adv_types_title: '类型与常量',
        adv_tea_title: '标准因子 API (TEA_*)',
        adv_get_others_title: '其余 Get* API',
        adv_reduction_title: '削单 API · TEA_ReductionRecommend',
        adv_rsquared_title: 'R² API · TEA_RSquared / TEA_RSquaredEx',
        adv_types_p: '对接时用到的因子 ID、Action 常量及标准信号结构（MQ4 中结构体名可能为 TEAStandardSignalData，以头文件为准）。',
        adv_factor_id_h3: '因子 ID（统一接口使用）',
        adv_const: '常量',
        adv_value: '值',
        adv_desc: '说明',
        adv_factor_0: 'EntropyHedge 熵场与对冲矩阵',
        adv_factor_1: 'TrendPenalty 趋势与惩罚',
        adv_factor_2: 'HedgeRegime 趋势·震荡·刹车',
        adv_factor_3: 'TrendStrengthBrake 多周期 R²·刹车强度',
        adv_struct_h3: '标准信号结构 TEAStandardSignal（MQ4 中为 TEAStandardSignalData）',
        adv_action_h3: 'Action 枚举',
        adv_tea_p: '以下为对接时实际调用的 API：创建因子、传入 K 线、取回方向/动作/置信度等。handle 在 MQ4 中为 int；数组顺序 下标 0 = 最旧一根 K 线，size-1 = 最新；必须先调用 Process 且返回 1，再调用 Get* 取信号，否则结果未定义。',
        adv_param: '入参',
        adv_type: '类型',
        adv_ret: '返回值',
        about_title: '介绍我们',
        about_p1: 'TraderEdgAIFactor 是一个基于 C++ 开发的算法因子库（DLL），供 MetaTrader 4 / 5 通过 MQL4/MQL5 直接调用。它把「趋势判断、震荡识别、削单建议、R² 趋势强度」等能力封装成统一接口，你只需把 DLL 和头文件放进 MT4/MT5 目录，在 EA 里几行代码即可拿到方向、动作、置信度等信号。',
        about_p2: '能解决什么问题：接入简单（无需自写复杂因子算法）、多因子可选（按策略选不同因子 ID）、信号统一（方向、动作、regime 等格式一致，便于和你的开平仓逻辑对接）。',
        about_p3: '典型用法一句话：创建因子 → 传入 K 线数据 → 调用 Process → 读取方向、动作、置信度。削单与 R² 为独立 API，按需调用。下面「快速完成对接」按场景给出极简代码和字段说明，让你一次性跑通。',
        quick_title: '快速完成对接',
        quick_p: '按你的需求选一个场景，按下面步骤即可对接成功。每个场景都给出极简代码，并对代码里用到的每个字段、每个入参/出参做解释，方便你一次跑通。',
        precond_title: '前置条件（所有场景通用）',
        scene_a_title: '场景 A：只要方向/动作',
        scene_b_title: '场景 B：只要趋势强度 R²',
        scene_c_title: '场景 C：只要削单建议',
        toc_concepts: '必读概念',
        toc_multi_factor: '多因子组合',
        toc_advanced: '进阶版（高级用户）→',
        quick_minimal_title: '5 分钟跑通：最小代码（推荐）',
        quick_minimal_p: '用 CTEAFactor 按名称初始化，Update 后 Signal 一次拿齐方向/动作。不知道选哪个因子？用 <code>"HedgeRegime"</code> 即可。只需单个值时可用快捷函数：<code>TEA_ATR()</code>、<code>TEA_Direction("HedgeRegime")</code>、<code>TEA_Action("HedgeRegime")</code>、<code>TEA_Brake("HedgeCore")</code>（适合每 Bar 一次调用）。',
        scenario_card_a_span: '只要方向/动作',
        scenario_card_a_small: '单因子 Init→Update→Signal，拿 direction/action',
        scenario_card_b_span: '只要趋势强度 R²',
        scenario_card_b_small: 'TEA_RSquared(closes, n) 一行取值',
        scenario_card_c_span: '只要削单建议',
        scenario_card_c_small: 'TEA_ReductionRecommend 按需调用',
        scenario_card_d_span: '查完整 API',
        scenario_card_d_small: '进阶版：全部函数、参数、返回值',
        concept_id: '<strong>因子 ID / 名称</strong>：0–16 对应不同算法，常用 2（HedgeRegime）、8（HedgeCore）。推荐用 <code>Init("HedgeRegime")</code> 按名称，不必记 ID。',
        concept_handle: '<strong>句柄 (handle)</strong>：Create 或 Init 返回的 int，后续 Process、Get* 都要传。CTEAFactor 封装后无需直接操作。',
        concept_process: '<strong>Process / Update</strong>：每次 K 线数据更新后调用一次，之后才能读 Direction、Action 等。',
        concept_action: '<strong>方向 (direction) / 动作 (action)</strong>：direction 为 -1 / 0 / +1；action 为 0=FLAT / 1=LONG / 2=SHORT。',
        concept_regime: '<strong>regime</strong>：1=趋势，2=震荡，0=不确定，-1=高风险。可用于减仓或刹车逻辑。',
        multi_intro: '用 CTEAFactorSelector 按名称组合多个因子：单因子直用、双因子主备（主 70% 子 30%）、3–8 因子投票（按 accuracy 加权）。组合因子（如 HedgeCore）与原子因子等价，都可参与。',
        multi_usage_1: '用法一：单因子',
        multi_usage_2: '用法二：双因子主备（主 70% + 子 30%）',
        multi_usage_3: '用法三：多因子投票（3–8 个）',
        multi_note: '汇总只产出 StandardSignal；要 ATR、Brake 等扩展字段时，需单独持有一个因子句柄调用 ATR()、Brake() 等。',
        advanced_cta_title: '进阶版（高级用户）',
        advanced_cta_p: '若需每个函数、每个入参/出参的完整说明，以及 MQ4 与 MQ5 双平台代码示例、注释与注意事项，请查看进阶版 API 文档。简单对接与进阶版已分开成两页，普通用户与高级用户互不干扰。',
        advanced_cta_btn: '进入进阶版 API 文档 →',
        copy_btn: '复制',
        copy_done: '已复制',
        precond_li1: '将 <code>TraderEdgAIFactor.dll</code> 放到 MT4 的 <code>MQL4/Libraries</code>（或 MT5 的 <code>MQL5/Libraries</code>）。',
        precond_li2: '将 <code>TraderEdgAIFactor.mqh</code> 放到 <code>MQL4/Include</code>（或 <code>MQL5/Include</code>）。',
        precond_li3: '在 EA 中 <code>#include &lt;TraderEdgAIFactor.mqh&gt;</code>（MQ4 也可用 <code>#import "TraderEdgAIFactor.dll"</code> 声明函数）。',
        precond_li4: '若 MT 提示不允许 DLL，请在「工具 → 选项 → 专家顾问」中勾选「允许 DLL 导入」。',
        scene_a_desc: '在 EA 里拿到「做多 / 做空 / 观望」以及方向强度，用于开平仓判断。下面用<strong>因子 ID = 2（HedgeRegime）</strong>做示例，推荐对冲/网格类策略使用；其他因子只需把 <code>TEA_FactorCreate(2)</code> 里的 2 改成 0/1/3，详见 <a href="factors.html">算法因子库</a>。',
        scene_a_code_title: '极简代码（MQ4，复制即用）',
        scene_a_table_h4: '字段与接口说明（本场景用到的）',
        table_name: '名称',
        table_meaning: '含义',
        table_usage: '怎么用',
        scene_a_success: '对接成功：编译通过，EA 挂到图表后，在 OnTick 里能正确读到 dir / act / regime（例如用 Print 输出），即表示本场景对接成功。使用 MT5 时，MQ5 示例见本页底部「进阶版」入口。',
        scene_a_g_h_m: '因子句柄',
        scene_a_g_h_u: '由 TEA_FactorCreate(2) 返回，后续 Process、GetDirection 等都要传这个值；MQ4 里是 int。',
        scene_a_ohlcv_m: 'K 线数组',
        scene_a_ohlcv_u: '开盘、最高、最低、收盘、成交量；下标 0 = 最旧一根，n-1 = 最新一根，顺序不能反。',
        scene_a_n_m: 'K 线根数',
        scene_a_n_u: '至少 50，建议 200；数组长度要和 Process 的 count 一致。',
        scene_a_process_m: '执行一次因子计算',
        scene_a_process_u: '每次 tick 或新 K 线时调用一次；返回 1 表示成功，之后才能读 GetDirection/GetAction。',
        scene_a_dir_m: '方向',
        scene_a_dir_u: 'double：-1.0 = 偏空，0 = 中性，+1.0 = 偏多；可用于仓位方向或过滤。',
        scene_a_act_m: '动作',
        scene_a_act_u: 'int：0 = FLAT（观望），1 = LONG（做多），2 = SHORT（做空）；直接用于开平仓判断。',
        scene_a_regime_m: '市场状态',
        scene_a_regime_u: 'int：1 = 趋势，2 = 震荡，-1 = 高风险；可用于减仓或刹车逻辑。',
        scene_b_closes_m: '收盘价数组',
        scene_b_closes_u: '顺序：下标 0 = 最旧，n-1 = 最新；由 CopyClose 或等价方式填充。',
        scene_b_n_m: '数组长度（周期）',
        scene_b_n_u: '即 R² 计算用的 K 线根数，建议 2～512；count < 2 时函数返回 0。',
        scene_b_r2_m: '计算 R²',
        scene_b_r2_u: '返回值 double，范围 0～1：越接近 1 趋势越强，接近 0 表示无明显趋势。',
        scene_c_ret_m: '返回值 1/0',
        scene_c_ret_u: '是否有推荐',
        scene_c_ret_usage: '1 = 有削单建议，可依 out_* 执行平仓；0 = 本 tick 不推荐削单。',
        scene_c_action_m: '动作类型',
        scene_c_action_usage: '1 = 单侧削多，2 = 单侧削空，3 = 跨侧削单。',
        scene_c_side_m: '亏损侧',
        scene_c_side_usage: '配合 out_loss_index 等可定位要平的亏损单。',
        scene_c_profit_m: '盈利段',
        scene_c_profit_usage: '先平盈利段（从 start_index 起共 profit_count 笔），再平亏损。',
        scene_b_desc: '在 EA 里拿到 0～1 的趋势强度（R²），替代手写 R² 计算，数值更稳定、抗异常值。无状态，每次传入收盘价数组和长度即可。',
        scene_b_code_title: '极简代码（MQ4）',
        scene_b_table_h4: '字段与接口说明',
        scene_b_success: '对接成功：编译通过，挂图后能稳定读到 0～1 的 r2 值即表示成功。需要 Theil-Sen 或指数加权等扩展时，见 <a href="api-advanced.html#rsquared">进阶版 · R² API</a>（TEA_RSquaredEx）。',
        scene_c_desc: '在对冲/马丁类 EA 里，根据当前多空两侧持仓与市场状态，拿到「本 tick 是否建议削单、削哪一侧、先平盈利还是亏损」等推荐。无状态，每次传入多空两侧的盈亏、手数、开仓时间等数组及少量参数即可。',
        scene_c_code_title: '极简用法说明',
        scene_c_api_p: '削单 API（<code>TEA_ReductionRecommend</code>）入参较多，这里只说明<strong>核心含义</strong>和<strong>返回值怎么用</strong>；完整参数与 MQ4/MQ5 示例见 <a href="api-advanced.html#reduction">进阶版 · 削单 API</a>。',
        scene_c_in_param: '<strong>入参</strong>：多侧与空侧各自的 profit[]、lots[]、open_time[]（按开仓时间升序），以及 regime、confidence、净利目标、是否允许跨侧等。若同时使用因子接口，regime、confidence 可直接传 <code>TEA_FactorGetRegime(句柄)</code>、<code>TEA_FactorGetConfidence(句柄)</code>；进阶版中有每个参数的说明与推荐取值。',
        scene_c_return: '<strong>返回</strong>：1 = 本 tick 有削单推荐，0 = 无推荐。通过 out_action、out_side、out_profit_start_index、out_profit_count 等输出参数可得到「单侧削多/削空」或「跨侧」以及要平的仓位索引与数量。',
        scene_c_table_h4: '关键输出字段（怎么用）',
        table_output: '输出',
        scene_c_success: '对接成功：在 EA 里按进阶版示例准备好多空两侧数组和参数，调用后能根据返回值与 out_* 正确执行一次「先平盈利再平亏损」的削单逻辑即表示成功。',
        adv_tea_create_factorid_desc: '因子 ID：0=EntropyHedge，1=TrendPenalty，2=HedgeRegime，3=TrendStrengthBrake。见上方类型与常量。',
        adv_tea_create_ret: '成功返回非 0 句柄，失败返回 0。MQ4 用 int 接收；OnInit 中若为 0 应返回 INIT_FAILED。',
        adv_tea_destroy_handle_desc: 'TEA_FactorCreate 返回的句柄。OnDeinit 中必须调用，且仅对非 0 句柄调用，避免重复释放。',
        adv_tea_process_handle_desc: '因子句柄，非 0。',
        adv_tea_process_ohlcv_desc: '开盘、最高、最低、收盘、成交量数组。顺序：下标 0 = 最旧 K 线，size-1 = 最新；与 MT 的 CopyOpen 等顺序一致（时间升序）。',
        adv_tea_process_size_desc: '数组长度，至少 50，建议 200。五组数组长度必须一致。',
        adv_tea_process_ret: '1=成功，0=失败。仅当返回 1 时方可调用 GetDirection/GetAction 等；否则不要读取信号。',
        adv_tea_get_handle_desc: '同上，且必须在本 tick 已成功调用过 TEA_FactorProcess(handle, ...) 且返回 1。',
        adv_tea_get_dir_desc: 'double：-1.0=偏空，0=中性，+1.0=偏多。用于过滤或仓位方向。',
        adv_tea_get_act_desc: 'int：0=FLAT（观望），1=LONG（做多），2=SHORT（做空）。直接用于开平仓判断。',
        adv_tea_get_regime_desc: 'int：1=趋势，2=震荡，-1=高风险。可用于减仓或刹车逻辑。',
        adv_get_others_intro: '以下 API 与 GetDirection/GetAction/GetRegime 调用约定相同：必须先在本 tick 调用 TEA_FactorProcess 且返回 1，再调用下列 Get*；否则返回值未定义。入参均为 int handle（因子句柄），下表仅列出返回值类型与含义。',
        adv_get_confidence_desc: 'double，0～1。信号置信度，常用于过滤：仅当 confidence > 某阈值时开仓，或传入削单接口 TEA_ReductionRecommend 的 confidence 参数。',
        adv_get_strength_desc: 'double，0～1。信号强度，可用于仓位权重或过滤弱信号。',
        adv_get_score_desc: 'double，0～1。综合评分，与标准信号结构中的 score 一致，用于排序或过滤。',
        adv_get_isvalid_desc: 'int：1=有效，0=无效。深度集成时建议必读：仅在返回 1 时依据 Action/Direction 开仓，否则本 tick 不交易，避免在无效信号上下单。',
        adv_get_accuracy_desc: 'int，0～100。准确度/质量分，与标准信号结构 accuracy_score 一致，可用于多因子加权或风控阈值。',
        adv_get_sl_desc: 'double。因子建议的止损价；0 表示本因子不提供止损，需自行计算或使用其他逻辑。',
        adv_get_tp_desc: 'double。因子建议的止盈价；0 表示本因子不提供止盈。',
        adv_get_brake_desc: 'int：0 或 1。仅 HedgeRegime 因子：刹车标志，1=当前建议刹车（减仓/观望），可用于对冲 EA 的减仓或暂停加仓逻辑。',
        adv_get_atr_desc: 'double。仅 HedgeRegime 因子：内部使用的 ATR 值，可用于与自算 ATR 对比或风控参考。',
        adv_get_brakestrength_desc: 'double，0～1。仅 TrendStrengthBrake 因子：刹车强度，用于多周期 R²·刹车类策略的仓位或风控。',
        adv_tea_note_usage: '常见用法：开仓前可组合判断，例如 if (TEA_FactorProcess(g_h, ...) == 1 && TEA_FactorIsValid(g_h) == 1 && TEA_FactorGetConfidence(g_h) >= 0.6) { ... } 再根据 GetAction 下单；若使用因子建议止损止盈，则读取 GetStopLoss/GetTakeProfit，为 0 时忽略。',
        adv_code_mq4_title: 'MQ4 对接代码片段（可直接复用）',
        adv_code_mq5_title: 'MQ5 对接代码片段（可直接复用）',
        adv_faq_tea: '常见问题：① 数组顺序反了会导致信号错误，务必 0=最旧；传入 Process 的 K 线数组不要使用 ArraySetAsSeries(true)，否则顺序会反。② Process 返回 0 时不要调用 Get*。③ handle 为 0 时不要调用任何接口。④ OnDeinit 里只对非 0 handle 调用 Destroy。',
        adv_reduction_intro: '无状态接口：每次传入多空两侧持仓的盈亏、手数、开仓时间等数组及少量控制参数，返回本 tick 是否建议削单及削哪一侧、先平盈利再平亏损。适合对冲/马丁 EA 的减仓决策。详见 <a href="factors.html">算法因子库</a> ReductionAdvisor。',
        adv_reduction_in_buy_desc: '多侧每笔持仓的浮动盈亏、手数、开仓时间（Unix 或 MQL 时间）。必须按开仓时间升序排列。',
        adv_reduction_in_count_buy: '多侧持仓笔数，与上面三个数组长度一致。',
        adv_reduction_in_sell_desc: '空侧同上，按开仓时间升序。',
        adv_reduction_in_count_sell: '空侧持仓笔数。',
        adv_reduction_in_regime: '市场状态：1=趋势，2=震荡，-1=高风险。可与 TEA_FactorGetRegime 一致。',
        adv_reduction_in_confidence: '置信度 0～1。',
        adv_reduction_in_target_net: '目标净利，可传 0。',
        adv_reduction_in_max_tail: '尾端（亏损段）最多保留笔数。',
        adv_reduction_in_min_margin: '最小保证金基数，可传 0。',
        adv_reduction_in_allow_cross: '是否允许跨侧削单：0=否，1=是。',
        adv_reduction_in_risk_mode: '风控模式，见头文件常量。',
        adv_reduction_out_action: '1=单侧削多，2=单侧削空，3=跨侧削单。',
        adv_reduction_out_side: '亏损侧。',
        adv_reduction_out_loss_idx: '亏损单索引。',
        adv_reduction_out_profit_start: '盈利段起始索引（先平这部分）。',
        adv_reduction_out_profit_count: '盈利段笔数。执行顺序：先平盈利段 [start_index, start_index+count)，再平亏损。',
        adv_reduction_out_seg_cross: '段侧、是否跨侧，见头文件。',
        adv_reduction_out_net_etc: '净利、削单潜能等，按需使用。',
        adv_reduction_out_strategy: '本次使用的策略标识。',
        adv_reduction_ret: '1=本 tick 有削单推荐，可按 out_* 执行平仓；0=无推荐。',
        adv_reduction_in_title: '入参说明',
        adv_reduction_out_title: '出参说明（DLL 写回，调用前需声明变量）',
        adv_reduction_code_title: 'MQ4 对接代码片段（声明出参变量后调用）',
        adv_reduction_faq: '常见问题：① 多空数组必须按开仓时间升序，否则推荐结果可能错误。② 出参必须提前声明变量，MQ4 中通过引用传回。③ 先平盈利再平亏损。④ allow_cross_side=0 时不会返回跨侧建议。完整签名以 TraderEdgAIFactor.mqh 为准。',
        adv_rsquared_intro: '无状态接口：传入收盘价数组与长度，返回 0～1 的趋势强度 R²。用于替代手写 R²，数值稳定、抗异常值。详见 <a href="factors.html">算法因子库</a> RSquared。',
        adv_rsquared_in_closes: '收盘价数组。下标 0 = 最旧 K 线，count-1 = 最新（时间升序）。',
        adv_rsquared_in_count: '数组长度，即计算 R² 的 K 线根数。建议 2～512；count<2 时返回 0。',
        adv_rsquared_ret: '0～1，越接近 1 趋势越强，接近 0 表示无明显趋势。',
        adv_rsquared_ex_same: '同上',
        adv_rsquared_ex_same_desc: '同上。',
        adv_rsquared_ex_mode: '0=Pearson（数值稳定），1=Theil-Sen 稳健，2=指数加权。',
        adv_rsquared_ex_out_slope: '可选，非 NULL 时写回拟合斜率。',
        adv_rsquared_code_mq4_title: 'MQ4 对接代码片段',
        adv_rsquared_code_mq5_title: 'MQ5 对接代码片段',
        adv_rsquared_faq: '常见问题：① 数组顺序必须 0=最旧，否则 R² 含义错误。② count<2 返回 0。③ 需 Theil-Sen 或指数加权时用 TEA_RSquaredEx(closes, n, mode, out_slope)。',
        adv_param_title: '参数',
        adv_ret_title: '返回值',
        doc_note_footer: '文档随 TraderEdgAIFactor 源码维护，若 DLL 版本更新请以实际导出与行为为准。',
        footer_advanced: '进阶版',
        footer_factor_lib: '算法因子库',
        footer_reduction_advisor: 'ReductionAdvisor',
        footer_rsquared: 'RSquared',
        footer_see: '详见',
        footer_download: '下载', footer_how: '极速上手', footer_api: 'API 文档', footer_pricing: '定价', footer_faq: '常见问题', footer_copy: '© TraderEdgeAI.com 使用前请阅读授权与免责声明。'
      },
      en: {
        title: 'API Docs | TraderEdgeAIFactor',
        title_advanced: 'API Docs · Advanced | TraderEdgeAIFactor',
        nav_how: 'Quick Start', nav_features: 'Features', nav_factors: 'Factors', nav_api: 'API Docs', nav_pricing: 'Pricing', nav_faq: 'FAQ', nav_cta: 'Get Pro', nav_price: '<s>$38/mo</s> $30/mo',
        nav_toggle_aria: 'Menu',
        back_to_simple: '← Back to simple',
        intro_title: 'Advanced API Docs',
        intro_p1: 'This page is for expert developers. For full parameter descriptions and MQ4/MQ5 code samples for every API, use this page.',
        intro_value: 'What this page provides:',
        intro_li1: 'Clear API contracts: in/out parameters and ranges to avoid misuse.',
        intro_li2: 'Ready-to-use MQ4/MQ5 snippets with notes on array order and return checks.',
        intro_li3: 'Only integration APIs—no internal or framework details.',
        intro_link: 'For minimal setup and scenario-based examples, see <a href="api.html">API Docs (simple)</a>.',
        adv_types_title: 'Types & constants',
        adv_tea_title: 'Standard factor API (TEA_*)',
        adv_get_others_title: 'Other Get* APIs',
        adv_reduction_title: 'Reduction API · TEA_ReductionRecommend',
        adv_rsquared_title: 'R² API · TEA_RSquared / TEA_RSquaredEx',
        adv_types_p: 'Factor IDs, Action constants, and standard signal structure used for integration (in MQ4 the struct name may be TEAStandardSignalData; see header).',
        adv_factor_id_h3: 'Factor ID (unified interface)',
        adv_const: 'Constant',
        adv_value: 'Value',
        adv_desc: 'Description',
        adv_factor_0: 'EntropyHedge entropy & hedge matrix',
        adv_factor_1: 'TrendPenalty trend & penalty',
        adv_factor_2: 'HedgeRegime trend · oscillation · brake',
        adv_factor_3: 'TrendStrengthBrake multi-period R² · brake strength',
        adv_struct_h3: 'Standard signal struct TEAStandardSignal (TEAStandardSignalData in MQ4)',
        adv_action_h3: 'Action enum',
        adv_tea_p: 'APIs for integration: create factor, pass OHLCV, get direction/action/confidence. handle is int in MQ4; array order: index 0 = oldest bar, size-1 = newest; call Process first and only when it returns 1 call Get* for signals, otherwise result is undefined.',
        adv_param: 'Parameter',
        adv_type: 'Type',
        adv_ret: 'Return',
        about_title: 'About',
        about_p1: 'TraderEdgAIFactor is a C++ factor library (DLL) for MetaTrader 4/5. It exposes trend, regime, reduction, and R² APIs. Place the DLL and headers in MT4/MT5, then call from your EA to get direction, action, confidence, and more.',
        about_p2: 'Benefits: easy integration, multiple factor IDs, and a unified signal format (direction, action, regime) for your EA logic.',
        about_p3: 'Typical flow: create factor → pass OHLCV → call Process → read direction, action, confidence. Reduction and R² are separate APIs.',
        quick_title: 'Quick integration',
        quick_p: 'Pick a scenario below and follow the steps. Each includes minimal code and field descriptions so you can run it once and succeed.',
        precond_title: 'Prerequisites (all scenarios)',
        scene_a_title: 'Scenario A: Direction / action only',
        scene_b_title: 'Scenario B: R² trend strength only',
        scene_c_title: 'Scenario C: Reduction advice only',
        toc_concepts: 'Essential concepts',
        toc_multi_factor: 'Multi-factor combination',
        toc_advanced: 'Advanced →',
        quick_minimal_title: '5-min quick start: Minimal code (recommended)',
        quick_minimal_p: 'Initialize CTEAFactor by name; after Update, Signal gives direction/action. Not sure which factor? Use <code>"HedgeRegime"</code>. For single values use helpers: <code>TEA_ATR()</code>, <code>TEA_Direction("HedgeRegime")</code>, <code>TEA_Action("HedgeRegime")</code>, <code>TEA_Brake("HedgeCore")</code> (once per Bar).',
        scenario_card_a_span: 'Direction / action only',
        scenario_card_a_small: 'Single factor Init→Update→Signal, get direction/action',
        scenario_card_b_span: 'R² trend strength only',
        scenario_card_b_small: 'TEA_RSquared(closes, n) — one line',
        scenario_card_c_span: 'Reduction advice only',
        scenario_card_c_small: 'TEA_ReductionRecommend on demand',
        scenario_card_d_span: 'Full API reference',
        scenario_card_d_small: 'Advanced: all functions, params, returns',
        concept_id: '<strong>Factor ID / name</strong>: 0–16 map to algorithms; common: 2 (HedgeRegime), 8 (HedgeCore). Prefer <code>Init("HedgeRegime")</code> by name.',
        concept_handle: '<strong>Handle</strong>: int returned by Create or Init; pass to Process, Get*. CTEAFactor wraps this, no direct use needed.',
        concept_process: '<strong>Process / Update</strong>: Call once after each K-line update, then read Direction, Action, etc.',
        concept_action: '<strong>Direction / Action</strong>: direction -1 / 0 / +1; action 0=FLAT, 1=LONG, 2=SHORT.',
        concept_regime: '<strong>regime</strong>: 1=trend, 2=range, 0=uncertain, -1=high risk. For reduce or brake logic.',
        multi_intro: 'Use CTEAFactorSelector to combine factors by name: single factor, dual primary/secondary (70%/30%), or 3–8 factor voting (accuracy-weighted). Composite factors (e.g. HedgeCore) are equivalent to atomic factors.',
        multi_usage_1: 'Usage 1: Single factor',
        multi_usage_2: 'Usage 2: Dual primary/secondary (70% + 30%)',
        multi_usage_3: 'Usage 3: Multi-factor voting (3–8)',
        multi_note: 'Selector outputs StandardSignal only; for ATR, Brake, etc., hold a factor handle and call ATR(), Brake() separately.',
        advanced_cta_title: 'Advanced (experts)',
        advanced_cta_p: 'For full API reference and MQ4/MQ5 code samples with notes, open the advanced API docs. Simple and advanced are on separate pages.',
        advanced_cta_btn: 'Open advanced API docs →',
        copy_btn: 'Copy',
        copy_done: 'Copied',
        precond_li1: 'Put <code>TraderEdgAIFactor.dll</code> in MT4 <code>MQL4/Libraries</code> (or MT5 <code>MQL5/Libraries</code>).',
        precond_li2: 'Put <code>TraderEdgAIFactor.mqh</code> in <code>MQL4/Include</code> (or <code>MQL5/Include</code>).',
        precond_li3: 'In your EA, <code>#include &lt;TraderEdgAIFactor.mqh&gt;</code> (MQ4 can also use <code>#import "TraderEdgAIFactor.dll"</code>).',
        precond_li4: 'If MT says DLL is not allowed, enable "Allow DLL imports" under Tools → Options → Expert Advisors.',
        scene_a_desc: 'Get direction/action (long / short / flat) and strength in your EA for open/close logic. Example uses <strong>factor ID 2 (HedgeRegime)</strong>; use 0/1/3 for other factors. See <a href="factors.html">Factor Library</a> for details.',
        scene_a_code_title: 'Minimal code (MQ4, copy & use)',
        scene_a_table_h4: 'Fields and API (this scenario)',
        table_name: 'Name',
        table_meaning: 'Meaning',
        table_usage: 'Usage',
        scene_a_success: 'Success: compile, attach EA to chart, and read dir / act / regime in OnTick (e.g. Print). For MT5, see Advanced at the bottom.',
        scene_a_g_h_m: 'Factor handle',
        scene_a_g_h_u: 'Returned by TEA_FactorCreate(2); pass to Process, GetDirection, etc.; int in MQ4.',
        scene_a_ohlcv_m: 'OHLCV arrays',
        scene_a_ohlcv_u: 'Open, high, low, close, volume; index 0 = oldest bar, n-1 = newest; order must not be reversed.',
        scene_a_n_m: 'Bar count',
        scene_a_n_u: 'At least 50, 200 recommended; length must match Process count.',
        scene_a_process_m: 'Run factor once',
        scene_a_process_u: 'Call once per tick or new bar; return 1 = success, then read GetDirection/GetAction.',
        scene_a_dir_m: 'Direction',
        scene_a_dir_u: 'double: -1.0 = bearish, 0 = neutral, +1.0 = bullish; for position or filter.',
        scene_a_act_m: 'Action',
        scene_a_act_u: 'int: 0 = FLAT, 1 = LONG, 2 = SHORT; for open/close logic.',
        scene_a_regime_m: 'Market regime',
        scene_a_regime_u: 'int: 1 = trend, 2 = range, -1 = high risk; for reduce or brake logic.',
        scene_b_closes_m: 'Close array',
        scene_b_closes_u: 'Order: index 0 = oldest, n-1 = newest; fill via CopyClose or equivalent.',
        scene_b_n_m: 'Array length (period)',
        scene_b_n_u: 'Bars used for R²; recommend 2–512; returns 0 when count < 2.',
        scene_b_r2_m: 'Compute R²',
        scene_b_r2_u: 'Returns double 0–1: closer to 1 = stronger trend, 0 = no clear trend.',
        scene_c_ret_m: 'Return 1/0',
        scene_c_ret_u: 'Has recommendation',
        scene_c_ret_usage: '1 = reduction recommended, use out_* to close; 0 = no reduction this tick.',
        scene_c_action_m: 'Action type',
        scene_c_action_usage: '1 = reduce long, 2 = reduce short, 3 = cross-side reduction.',
        scene_c_side_m: 'Loss side',
        scene_c_side_usage: 'With out_loss_index to locate loss orders to close.',
        scene_c_profit_m: 'Profit segment',
        scene_c_profit_usage: 'Close profit segment first (from start_index, profit_count bars), then loss.',
        scene_b_desc: 'Get 0–1 trend strength (R²) in your EA; replaces hand-written R², more stable. Stateless; pass close array and length each time.',
        scene_b_code_title: 'Minimal code (MQ4)',
        scene_b_table_h4: 'Fields and API',
        scene_b_success: 'Success: compile, attach, and read 0–1 r2. For Theil-Sen or EWM, see <a href="api-advanced.html#rsquared">Advanced · R² API</a> (TEA_RSquaredEx).',
        scene_c_desc: 'In hedge/martingale EAs, get "this tick: reduce or not, which side, profit first then loss". Stateless; pass buy/sell profit, lots, open_time arrays and a few params.',
        scene_c_code_title: 'Usage summary',
        scene_c_api_p: 'TEA_ReductionRecommend has many params; here we only describe <strong>meaning</strong> and <strong>return</strong>. Full params and MQ4/MQ5 samples are in <a href="api-advanced.html#reduction">Advanced · Reduction API</a>.',
        scene_c_in_param: '<strong>Inputs</strong>: profit[], lots[], open_time[] per side (asc by open time), regime, confidence, target net, allow cross-side, etc. If using factor, pass <code>TEA_FactorGetRegime(handle)</code>, <code>TEA_FactorGetConfidence(handle)</code>.',
        scene_c_return: '<strong>Return</strong>: 1 = recommendation this tick, 0 = none. Use out_action, out_side, out_profit_start_index, out_profit_count to execute profit-first then loss.',
        scene_c_table_h4: 'Key outputs (usage)',
        table_output: 'Output',
        scene_c_success: 'Success: prepare buy/sell arrays per Advanced example, call API, and execute one "profit first then loss" reduction using return and out_*.',
        adv_tea_create_factorid_desc: 'Factor ID: 0=EntropyHedge, 1=TrendPenalty, 2=HedgeRegime, 3=TrendStrengthBrake. See Types & constants above.',
        adv_tea_create_ret: 'Returns non-zero handle on success, 0 on failure. MQ4 uses int; return INIT_FAILED in OnInit if 0.',
        adv_tea_destroy_handle_desc: 'Handle returned by TEA_FactorCreate. Must call in OnDeinit; only for non-zero handle to avoid double free.',
        adv_tea_process_handle_desc: 'Factor handle, non-zero.',
        adv_tea_process_ohlcv_desc: 'Open, high, low, close, volume arrays. Order: index 0 = oldest bar, size-1 = newest; same as MT CopyOpen (ascending time).',
        adv_tea_process_size_desc: 'Array length; at least 50, 200 recommended. All five arrays must have same length.',
        adv_tea_process_ret: '1=success, 0=failure. Only when 1 may you call GetDirection/GetAction etc.; otherwise do not read signals.',
        adv_tea_get_handle_desc: 'Same as above; must have called TEA_FactorProcess(handle, ...) successfully this tick and got 1.',
        adv_tea_get_dir_desc: 'double: -1.0=bearish, 0=neutral, +1.0=bullish. For filter or position direction.',
        adv_tea_get_act_desc: 'int: 0=FLAT, 1=LONG, 2=SHORT. For open/close logic.',
        adv_tea_get_regime_desc: 'int: 1=trend, 2=range, -1=high risk. For reduce or brake logic.',
        adv_get_others_intro: 'Same calling convention as GetDirection/GetAction/GetRegime: call TEA_FactorProcess and get 1 this tick before calling these Get*; otherwise return value undefined. All take int handle; table lists return type and meaning.',
        adv_get_confidence_desc: 'double 0–1. Signal confidence; use for filter (e.g. open only when > threshold) or pass to TEA_ReductionRecommend confidence param.',
        adv_get_strength_desc: 'double 0–1. Signal strength; for position weight or filter weak signals.',
        adv_get_score_desc: 'double 0–1. Composite score, same as score in standard signal struct; for sort or filter.',
        adv_get_isvalid_desc: 'int: 1=valid, 0=invalid. Recommended for deep integration: only trade on Action/Direction when 1; otherwise skip this tick.',
        adv_get_accuracy_desc: 'int 0–100. Accuracy/quality score, same as accuracy_score in standard struct; for multi-factor weight or risk threshold.',
        adv_get_sl_desc: 'double. Suggested stop loss; 0 means factor does not provide SL, compute yourself or use other logic.',
        adv_get_tp_desc: 'double. Suggested take profit; 0 means factor does not provide TP.',
        adv_get_brake_desc: 'int 0 or 1. HedgeRegime only: brake flag; 1=recommend brake (reduce/flat); for hedge EA reduce or pause add.',
        adv_get_atr_desc: 'double. HedgeRegime only: internal ATR; compare with your own ATR or for risk reference.',
        adv_get_brakestrength_desc: 'double 0–1. TrendStrengthBrake only: brake strength; for multi-period R² brake strategies.',
        adv_tea_note_usage: 'Common usage: e.g. if (TEA_FactorProcess(g_h, ...) == 1 && TEA_FactorIsValid(g_h) == 1 && TEA_FactorGetConfidence(g_h) >= 0.6) { ... } then trade by GetAction; if using factor SL/TP, read GetStopLoss/GetTakeProfit; ignore when 0.',
        adv_code_mq4_title: 'MQ4 code snippet (copy & use)',
        adv_code_mq5_title: 'MQ5 code snippet (copy & use)',
        adv_faq_tea: 'FAQ: ① Wrong array order causes wrong signals; index 0 = oldest. Do not use ArraySetAsSeries(true) for Process arrays. ② Do not call Get* when Process returns 0. ③ Do not call any API when handle is 0. ④ In OnDeinit only call Destroy for non-zero handle.',
        adv_reduction_intro: 'Stateless: pass buy/sell profit, lots, open_time arrays and a few params each time; returns whether to reduce this tick, which side, profit first then loss. For hedge/martingale EA. See <a href="factors.html">Factor Library</a> ReductionAdvisor.',
        adv_reduction_in_buy_desc: 'Per-position floating P/L, lots, open time (Unix or MQL). Must be ascending by open time.',
        adv_reduction_in_count_buy: 'Buy-side position count; must match array lengths.',
        adv_reduction_in_sell_desc: 'Sell side same as above; ascending by open time.',
        adv_reduction_in_count_sell: 'Sell-side position count.',
        adv_reduction_in_regime: 'Market regime: 1=trend, 2=range, -1=high risk. Can use TEA_FactorGetRegime.',
        adv_reduction_in_confidence: 'Confidence 0–1.',
        adv_reduction_in_target_net: 'Target net profit; can pass 0.',
        adv_reduction_in_max_tail: 'Max tail (loss segment) bars to keep.',
        adv_reduction_in_min_margin: 'Min margin base; can pass 0.',
        adv_reduction_in_allow_cross: 'Allow cross-side reduction: 0=no, 1=yes.',
        adv_reduction_in_risk_mode: 'Risk mode; see header constants.',
        adv_reduction_out_action: '1=reduce long, 2=reduce short, 3=cross-side reduction.',
        adv_reduction_out_side: 'Loss side.',
        adv_reduction_out_loss_idx: 'Loss order index.',
        adv_reduction_out_profit_start: 'Profit segment start index (close this first).',
        adv_reduction_out_profit_count: 'Profit segment count. Order: close [start_index, start_index+count), then loss.',
        adv_reduction_out_seg_cross: 'Segment side, cross-side; see header.',
        adv_reduction_out_net_etc: 'Net profit, reduction potential, etc.; use as needed.',
        adv_reduction_out_strategy: 'Strategy ID used this call.',
        adv_reduction_ret: '1=reduction recommended this tick, use out_* to close; 0=none.',
        adv_reduction_in_title: 'Inputs',
        adv_reduction_out_title: 'Outputs (DLL writes back; declare variables before call)',
        adv_reduction_code_title: 'MQ4 code snippet (declare output vars then call)',
        adv_reduction_faq: 'FAQ: ① Arrays must be ascending by open time or result may be wrong. ② Declare output vars before call; MQ4 passes by reference. ③ Close profit first then loss. ④ allow_cross_side=0 never returns cross-side. See TraderEdgAIFactor.mqh for full signature.',
        adv_rsquared_intro: 'Stateless: pass close array and length; returns 0–1 trend strength R². Replaces hand-written R², stable. See <a href="factors.html">Factor Library</a> RSquared.',
        adv_rsquared_in_closes: 'Close array. Index 0 = oldest bar, count-1 = newest (ascending time).',
        adv_rsquared_in_count: 'Array length (bars for R²). Recommend 2–512; returns 0 when count<2.',
        adv_rsquared_ret: '0–1; closer to 1 = stronger trend, 0 = no clear trend.',
        adv_rsquared_ex_same: 'Same as above',
        adv_rsquared_ex_same_desc: 'Same as above.',
        adv_rsquared_ex_mode: '0=Pearson (stable), 1=Theil-Sen robust, 2=exponential weighted.',
        adv_rsquared_ex_out_slope: 'Optional; if non-NULL, slope is written back.',
        adv_rsquared_code_mq4_title: 'MQ4 code snippet',
        adv_rsquared_code_mq5_title: 'MQ5 code snippet',
        adv_rsquared_faq: 'FAQ: ① Array order must be 0=oldest or R² meaning is wrong. ② count<2 returns 0. ③ Use TEA_RSquaredEx(closes, n, mode, out_slope) for Theil-Sen or EWM.',
        adv_param_title: 'Parameter',
        adv_ret_title: 'Return',
        doc_note_footer: 'Docs follow TraderEdgAIFactor source; if DLL is updated, follow actual exports and behavior.',
        footer_advanced: 'Advanced',
        footer_factor_lib: 'Factor Library',
        footer_reduction_advisor: 'ReductionAdvisor',
        footer_rsquared: 'RSquared',
        footer_see: 'See',
        footer_download: 'Download', footer_how: 'Quick Start', footer_api: 'API Docs', footer_pricing: 'Pricing', footer_faq: 'FAQ', footer_copy: '© TraderEdgeAI.com Please read the license and disclaimer.'
      }
    }
  };

  function getLang() {
    return localStorage.getItem('lang') || 'zh';
  }

  function setLang(lang) {
    localStorage.setItem('lang', lang);
  }

  function applyLang(lang, page) {
    page = page || (document.body && document.body.getAttribute('data-i18n-page')) || 'index';
    var t = LANG[page] && LANG[page][lang];
    if (!t) return;
    if (page === 'api' && typeof window !== 'undefined' && window.location && window.location.pathname.indexOf('api-advanced') !== -1 && t.title_advanced) document.title = t.title_advanced;
    else if (t.title) document.title = t.title;
    document.querySelectorAll('[data-i18n]').forEach(function (el) {
      var key = el.getAttribute('data-i18n');
      var val = t[key];
      if (val === undefined) return;
      if (el.hasAttribute('data-i18n-html') && el.getAttribute('data-i18n-html') !== 'false') {
        el.innerHTML = val;
      } else {
        el.textContent = val;
      }
    });
    document.querySelectorAll('[data-i18n-attr]').forEach(function (el) {
      var spec = el.getAttribute('data-i18n-attr');
      if (!spec || spec.indexOf(':') === -1) return;
      var parts = spec.split(':');
      var attr = parts[0].trim();
      var key = parts.slice(1).join(':').trim();
      var val = t[key];
      if (val !== undefined) el.setAttribute(attr, val);
    });
    document.documentElement.lang = lang === 'zh' ? 'zh-CN' : 'en';
    document.body.classList.remove('lang-zh', 'lang-en');
    document.body.classList.add('lang-' + lang);
    if (typeof window.onLangApply === 'function') window.onLangApply(lang, page);
  }

  window.I18N = { LANG: LANG, getLang: getLang, setLang: setLang, applyLang: applyLang };
})();
